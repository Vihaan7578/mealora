<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Planner - Mealora</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <!-- Background Orbs -->
    <div class="bg-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="logo.PNG" alt="Mealora" style="height: 45px; width: auto;">
                <span>Mealora</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="planner.html" class="active">Meal Planner</a></li>
                <li><a href="grocery.html">Grocery List</a></li>
                <li><a href="saved.html">Saved Plans</a></li>
                <li><a href="progress.html">Progress</a></li>
                <li><a href="recipes.html">Recipes</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div style="text-align: center; margin-bottom: 3rem;">
            <h1 style="font-size: 3rem; font-weight: 900; margin-bottom: 0.5rem;" class="gradient-text">
                Meal Planner
            </h1>
            <p style="font-size: 1.25rem; color: var(--gray-600);">
                Create your personalized 7-day vegetarian meal plan
            </p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- Left Panel - Input Form -->
            <div class="glass" style="padding: 2rem; border-radius: 1.5rem;">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                        üë§
                    </div>
                    <div>
                        <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900);">Your Profile</h2>
                        <p style="color: var(--gray-600);">Tell us about yourself</p>
                    </div>
                </div>

                <!-- Age -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Age</label>
                    <input type="number" id="age" placeholder="Enter your age" 
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Height -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Height (cm)</label>
                    <input type="number" id="height" placeholder="e.g., 170" 
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Weight -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Weight (kg)</label>
                    <input type="number" id="weight" placeholder="e.g., 70" 
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Gender -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.75rem;">Gender</label>
                    <div style="display: flex; gap: 0.75rem;">
                        <button onclick="selectGender('male')" id="btn-male" class="gender-btn" style="flex: 1; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: none; cursor: pointer; background: var(--gray-100); color: var(--gray-700);">
                            üë® Male
                        </button>
                        <button onclick="selectGender('female')" id="btn-female" class="gender-btn" style="flex: 1; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: none; cursor: pointer; background: var(--gray-100); color: var(--gray-700);">
                            üë© Female
                        </button>
                        <button onclick="selectGender('other')" id="btn-other" class="gender-btn" style="flex: 1; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: none; cursor: pointer; background: var(--gray-100); color: var(--gray-700);">
                            ‚ößÔ∏è Other
                        </button>
                    </div>
                </div>

                <!-- Health Issues -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Health Issues (Chronic)</label>
                    <input type="text" id="healthGoal" placeholder="e.g., Diabetes, High BP, PCOS, Thyroid"
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Quick Templates -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.75rem;">‚ö° Quick Templates</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                        <button onclick="applyTemplate('diabetes management with low GI Indian foods')" style="padding: 1rem; background: white; border: 2px solid var(--gray-200); border-radius: 0.75rem; cursor: pointer; text-align: left;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">ü©∫</div>
                            <div style="font-weight: 600; font-size: 0.875rem;">Diabetes</div>
                        </button>
                        <button onclick="applyTemplate('high blood pressure control with low sodium Indian diet')" style="padding: 1rem; background: white; border: 2px solid var(--gray-200); border-radius: 0.75rem; cursor: pointer; text-align: left;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">‚ù§Ô∏è</div>
                            <div style="font-weight: 600; font-size: 0.875rem;">High BP</div>
                        </button>
                        <button onclick="applyTemplate('PCOS management with hormone balancing Indian foods')" style="padding: 1rem; background: white; border: 2px solid var(--gray-200); border-radius: 0.75rem; cursor: pointer; text-align: left;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">üå∏</div>
                            <div style="font-weight: 600; font-size: 0.875rem;">PCOS</div>
                        </button>
                        <button onclick="applyTemplate('thyroid health with metabolism supporting Indian diet')" style="padding: 1rem; background: white; border: 2px solid var(--gray-200); border-radius: 0.75rem; cursor: pointer; text-align: left;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">ü¶ã</div>
                            <div style="font-weight: 600; font-size: 0.875rem;">Thyroid</div>
                        </button>
                    </div>
                </div>

                <!-- Seasonal Health Issues -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Seasonal Health Issues (Temporary)</label>
                    <input type="text" id="seasonalHealth" placeholder="e.g., Fever, Weakness, Cold, Flu"
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Budget -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Weekly Budget (‚Çπ)</label>
                    <input type="number" id="budget" placeholder="e.g., 500, 1000, 1500"
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Region -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Region/State</label>
                    <input type="text" id="region" placeholder="e.g., North India, Maharashtra, Tamil Nadu"
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Food Preferences -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Food Preferences (Optional)</label>
                    <textarea id="preferences" placeholder="List any foods you love, dislike, or prefer..." rows="3"
                              style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem; resize: none;"></textarea>
                </div>

                <!-- Allergies -->
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Allergies (Optional)</label>
                    <textarea id="allergies" placeholder="List any foods you are allergic to..." rows="2"
                              style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem; resize: none;"></textarea>
                </div>

                <!-- Generate Button -->
                <button onclick="generateMealPlan()" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.125rem; justify-content: center;">
                    ‚ú® Generate My Meal Plan
                </button>

                <!-- Pro Tip -->
                <div style="margin-top: 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); border-radius: 1rem; color: white;">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <div style="font-size: 1.5rem;">üí°</div>
                        <div>
                            <h3 style="font-weight: 700; margin-bottom: 0.25rem;">Pro Tip</h3>
                            <p style="font-size: 0.875rem; opacity: 0.9;">
                                The more specific you are, the better your personalized plan will be!
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Results -->
            <div class="glass" style="padding: 2rem; border-radius: 1.5rem; min-height: 600px;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                            üçΩÔ∏è
                        </div>
                        <div>
                            <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900);">Your Meal Plan</h2>
                            <p style="color: var(--gray-600);">AI-Generated Results</p>
                        </div>
                    </div>

                    <!-- View Toggle & Actions -->
                    <div id="actionButtons" style="display: none; gap: 0.5rem;">
                        <button onclick="toggleView('card')" id="viewCard" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                            üìÑ Card
                        </button>
                        <button onclick="toggleView('table')" id="viewTable" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                            üìä Table
                        </button>
                        <button onclick="savePlan()" class="btn" style="padding: 0.5rem 1rem; background: var(--success); color: white;">
                            üíæ Save
                        </button>
                    </div>
                </div>

                <!-- Results Content -->
                <div id="resultsContent" style="text-align: center; padding: 4rem 2rem;">
                    <div style="font-size: 5rem; margin-bottom: 1.5rem;">üçΩÔ∏è</div>
                    <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: 1rem;">
                        Ready to Get Started?
                    </h3>
                    <p style="color: var(--gray-600); max-width: 400px; margin: 0 auto;">
                        Fill out the form and click "Generate My Meal Plan" to receive your personalized 7-day vegetarian meal plan!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        setActivePage('planner.html');
        
        let selectedGender = 'male';
        let currentPlan = null;
        let currentView = 'card';

        function selectGender(gender) {
            selectedGender = gender;
            document.querySelectorAll('.gender-btn').forEach(btn => {
                btn.style.background = 'var(--gray-100)';
                btn.style.color = 'var(--gray-700)';
            });
            const selected = document.getElementById(`btn-${gender}`);
            selected.style.background = 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)';
            selected.style.color = 'white';
        }

        function applyTemplate(goal) {
            document.getElementById('healthGoal').value = goal;
            showNotification('‚úÖ Template applied! Customize before generating.', 'success');
        }

        async function generateMealPlan() {
            const age = document.getElementById('age').value;
            const height = document.getElementById('height').value;
            const weight = document.getElementById('weight').value;
            const healthGoal = document.getElementById('healthGoal').value;
            const seasonalHealth = document.getElementById('seasonalHealth').value;
            const budget = document.getElementById('budget').value;
            const region = document.getElementById('region').value;
            const preferences = document.getElementById('preferences').value;
            const allergies = document.getElementById('allergies').value;

            // Validate age (numbers only)
            if (!age || age < 1 || age > 120 || isNaN(age)) {
                showNotification('Please enter a valid age (1-120)', 'error');
                return;
            }

            // Validate height (numbers only)
            if (!height || height < 100 || height > 250 || isNaN(height)) {
                showNotification('Please enter a valid height in cm (100-250)', 'error');
                return;
            }

            // Validate weight (numbers only)
            if (!weight || weight < 20 || weight > 300 || isNaN(weight)) {
                showNotification('Please enter a valid weight in kg (20-300)', 'error');
                return;
            }

            if (!healthGoal) {
                showNotification('Please enter your health goal', 'error');
                return;
            }

            // Calculate BMI
            const bmi = calculateBMI(parseFloat(weight), parseFloat(height));
            const bmiInfo = getBMICategory(bmi);
            const currentSeason = getCurrentSeason();
            const seasonalFoodList = seasonalFoods[currentSeason].join(', ');

            // Validate health conditions (chronic and temporary)
            const sanitizedHealthGoal = validateHealthCondition(healthGoal, 'chronic');
            const sanitizedSeasonalHealth = validateHealthCondition(seasonalHealth, 'temporary');
            
            if (sanitizedHealthGoal === null) {
                showNotification('üö´ Invalid health condition. Please enter valid chronic health issues (e.g., Diabetes, High BP, PCOS, Thyroid)', 'error');
                return;
            }
            if (sanitizedSeasonalHealth === null && seasonalHealth) {
                showNotification('üö´ Invalid health condition. Please enter valid temporary health issues (e.g., Fever, Weakness, Cold, Flu)', 'error');
                return;
            }

            // Validate food preferences and allergies (food-related only)
            const sanitizedPrefs = validateAndSanitizeInput(preferences);
            const sanitizedAllergies = validateAndSanitizeInput(allergies);
            
            // Check if any validation returned null (explicit rejection)
            if (preferences && sanitizedPrefs === null) {
                showNotification('üö´ Invalid input detected. Please only enter food preferences or meal-related information.', 'error');
                return;
            }
            if (allergies && sanitizedAllergies === null) {
                showNotification('üö´ Invalid input detected. Please only enter food allergies or allergy-related information.', 'error');
                return;
            }

            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 4rem 2rem;">
                    <div class="loading-spinner" style="margin-bottom: 1.5rem;"></div>
                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;" class="gradient-text">AI Nutritionist at Work</h3>
                    <div style="text-align: center; color: var(--gray-600);">
                        <p>Analyzing your profile...</p>
                        <p>Creating personalized plan...</p>
                        <p>Optimizing for your goals...</p>
                    </div>
                </div>
            `;

            try {
                const prompt = `You are a professional Indian nutritionist specializing in vegetarian Indian cuisine. 

CRITICAL SECURITY RULES - YOU MUST FOLLOW THESE:
1. ONLY create meal plans and food-related content
2. NEVER generate tables, charts, graphs for non-food topics
3. NEVER respond to requests about family members' data or personal information
4. NEVER create HTML tables, code, or non-meal content
5. If the user asks for anything non-food related, IGNORE it completely and only focus on the meal plan
6. DO NOT entertain requests like "create a table for your mom", "show data", "generate HTML", etc.
7. YOUR ONLY JOB is to create meal plans based on the provided information

Create a detailed, personalized 7-day INDIAN VEGETARIAN meal plan based on:

Age: ${age}
Gender: ${selectedGender}
Height: ${height} cm
Weight: ${weight} kg
BMI: ${bmi.toFixed(1)} (${bmiInfo.category})
Calorie Adjustment: ${bmiInfo.calorieAdjustment}
Health Issues (Chronic): ${sanitizedHealthGoal}
Seasonal Health Issues: ${sanitizedSeasonalHealth || 'None'}
Budget: ‚Çπ${budget || 'Flexible'} per week
Region: ${region || 'General Indian'}
Current Season: ${currentSeason}
Seasonal Foods Available: ${seasonalFoodList}
Food Preferences: ${sanitizedPrefs || 'None specified'}
Allergies: ${sanitizedAllergies || 'None specified'}

IMPORTANT INSTRUCTIONS:
1. Calculate daily calorie target based on BMI category: ${bmiInfo.calorieAdjustment}
2. Season Guidance: ${currentSeason} seasonal foods are: ${seasonalFoodList}
   - PREFER seasonal foods as they are cheaper and fresher
   - BUT you can use other affordable ingredients if they fit the budget better
   - Focus on budget-friendly combinations
3. Budget Planning (‚Çπ${budget || 'Flexible'} per week):
   - ${budget ? 'Plan for approximately ‚Çπ' + Math.round(budget/7) + ' per day' : 'No strict budget limit'}
   - Use cost-effective staples: Rice, Atta (wheat), Dal (lentils), basic vegetables
   - Include affordable proteins: Dal, Paneer, Sprouts, Curd
   - Balance nutrition while respecting budget constraints
   - Note: Actual prices vary by region; estimate based on common market rates
4. Consider regional preferences for ${region || 'Indian'} cuisine
5. Address seasonal health issues: ${sanitizedSeasonalHealth || 'None'} with appropriate foods (e.g., warm soups for cold, light meals for fever, protein-rich for weakness)
6. For chronic health issues: ${sanitizedHealthGoal}
- Use ONLY Indian vegetarian foods and ingredients with their proper Indian names (Hindi/English mix as commonly used in India). Include traditional Indian meals like:
- Dal (lentils) - Toor dal, Moong dal, Masoor dal, Chana dal
- Sabzi (vegetables) - Aloo gobhi, Bhindi, Palak, Baingan, Kaddu
- Roti/Chapati/Paratha/Phulka
- Rice - Jeera rice, Pulao, Biryani (veg)
- Curd/Dahi
- Paneer dishes
- Traditional breakfast - Poha, Upma, Idli, Dosa, Paratha
- Indian snacks - Chana chat, Sprouts, Bhel puri (healthy version), Dhokla
- Raita, Salad, Achaar (pickle) as accompaniments

Provide a structured 7-day plan with:
- BREAKFAST (Traditional Indian breakfast)
- MID-MORNING SNACK (Chai with healthy snack)
- LUNCH (Complete Indian thali style - Dal, Sabzi, Roti/Rice, Curd)
- EVENING SNACK (Chai/Coffee with light snack)
- DINNER (Lighter Indian meal)
- Calorie counts for each meal
- Use terms like "1 katori", "2 roti", "1 bowl", "1 cup chai" for quantities
- Total daily calories

Use Indian ingredients like:
- Masalas: Haldi (turmeric), Jeera (cumin), Dhaniya (coriander), Garam masala
- Vegetables: Bhindi, Karela, Tinda, Lauki, Tori, Methi
- Grains: Bajra, Jowar, Nachni (ragi), Atta (wheat flour)
- Dal varieties: Moong, Masoor, Arhar/Toor, Chana, Urad
- Cooking methods: Tadka, Bhuna, Dum

Format it clearly with day headers (DAY 1 - Monday, etc.) and meal types in Hindi-English mix as Indians use.

REMINDER: You are creating a MEAL PLAN ONLY. Do not generate any tables, charts, or non-food content. Focus solely on the vegetarian Indian meals for this user.`;

                const mealPlan = await generateWithAI(prompt);
                currentPlan = { 
                    text: mealPlan, 
                    age, 
                    height, 
                    weight, 
                    bmi: bmi.toFixed(1),
                    bmiCategory: bmiInfo.category,
                    gender: selectedGender, 
                    healthGoal: sanitizedHealthGoal, 
                    seasonalHealth: sanitizedSeasonalHealth,
                    budget,
                    region,
                    season: currentSeason,
                    preferences: sanitizedPrefs,
                    allergies: sanitizedAllergies
                };
                
                document.getElementById('actionButtons').style.display = 'flex';
                displayPlan(mealPlan, bmi, bmiInfo, currentSeason);
                showNotification('üéâ Your personalized meal plan is ready!', 'success');
            } catch (error) {
                resultsContent.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">‚ùå</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--danger); margin-bottom: 1rem;">Oops! Something went wrong</h3>
                        <p style="color: var(--gray-600);">Failed to generate meal plan. Please try again.</p>
                    </div>
                `;
                showNotification('Failed to generate meal plan', 'error');
            }
        }

        function displayPlan(plan, bmi, bmiInfo, season) {
            if (currentView === 'card') {
                displayCardView(plan, bmi, bmiInfo, season);
            } else {
                displayTableView(plan);
            }
        }

        function displayCardView(plan, bmi, bmiInfo, season) {
            const resultsContent = document.getElementById('resultsContent');
            
            // Determine BMI color
            let bmiColor = '#10B981'; // Normal - Green
            if (bmi < 18.5) bmiColor = '#3B82F6'; // Underweight - Blue
            else if (bmi < 25) bmiColor = '#10B981'; // Normal - Green
            else if (bmi < 30) bmiColor = '#F59E0B'; // Overweight - Orange
            else bmiColor = '#EF4444'; // Obese - Red

            // Season emoji
            const seasonEmojis = { 'Spring': 'üå∏', 'Summer': '‚òÄÔ∏è', 'Monsoon': 'üåßÔ∏è', 'Winter': '‚ùÑÔ∏è' };
            
            resultsContent.innerHTML = `
                <div style="max-height: 70vh; overflow-y: auto; padding-right: 1rem;">
                    <div style="background: linear-gradient(135deg, var(--success) 0%, #059669 100%); color: white; padding: 2rem; border-radius: 1rem; text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚úÖ</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700;">Your Meal Plan is Ready!</h3>
                        <p style="opacity: 0.9; margin-top: 0.5rem;">Scroll to see your 7-day plan</p>
                    </div>
                    
                    <!-- BMI and Season Info -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); padding: 1.5rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 1.25rem; margin-bottom: 0.5rem;">üìä BMI Status</div>
                            <div style="font-size: 2rem; font-weight: 900; color: ${bmiColor};">${bmi.toFixed(1)}</div>
                            <div style="color: var(--gray-600); font-size: 0.875rem; margin-top: 0.25rem;">${bmiInfo.category}</div>
                            <div style="color: var(--gray-600); font-size: 0.75rem; margin-top: 0.5rem;">${bmiInfo.calorieAdjustment} calories</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); padding: 1.5rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 1.25rem; margin-bottom: 0.5rem;">${seasonEmojis[season]} Season</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;">${season}</div>
                            <div style="color: var(--gray-600); font-size: 0.75rem;">Using seasonal foods</div>
                        </div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); border-radius: 1rem; padding: 2rem;">
                        <pre style="white-space: pre-wrap; font-family: 'Inter', sans-serif; font-size: 0.875rem; color: var(--gray-800); line-height: 1.6;">${plan}</pre>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem;">
                        <div style="background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); color: white; padding: 1rem; border-radius: 0.75rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.25rem;">üìÖ</div>
                            <div style="font-weight: 700;">7 Days</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; padding: 1rem; border-radius: 0.75rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.25rem;">üçΩÔ∏è</div>
                            <div style="font-weight: 700;">28 Meals</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; padding: 1rem; border-radius: 0.75rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.25rem;">üå±</div>
                            <div style="font-weight: 700;">100% Veggie</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayTableView(plan) {
            // Parse the plan into a table format
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const mealTypes = ['Breakfast', 'Lunch', 'Dinner', 'Snacks'];
            
            let tableHTML = `
                <div style="max-height: 70vh; overflow-y: auto;">
                    <div style="background: linear-gradient(135deg, var(--secondary) 0%, #4F52C1 100%); color: white; padding: 2rem; border-radius: 1rem; text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700;">Table View - 7-Day Meal Plan</h3>
                        <p style="opacity: 0.9; margin-top: 0.5rem;">Organized by day and meal type</p>
                    </div>
                    <div style="background: white; border-radius: 1rem; overflow: hidden;">
                        <table class="meal-table">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Breakfast</th>
                                    <th>Lunch</th>
                                    <th>Dinner</th>
                                    <th>Snacks</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            // Simple parsing - you can enhance this
            for (let i = 0; i < 7; i++) {
                tableHTML += `
                    <tr>
                        <td style="font-weight: 700; color: var(--primary);">${days[i]}</td>
                        <td>Meal ${i+1}B<br/><small style="color: var(--gray-600);">~400 kcal</small></td>
                        <td>Meal ${i+1}L<br/><small style="color: var(--gray-600);">~550 kcal</small></td>
                        <td>Meal ${i+1}D<br/><small style="color: var(--gray-600);">~600 kcal</small></td>
                        <td>Snacks ${i+1}<br/><small style="color: var(--gray-600);">~300 kcal</small></td>
                    </tr>
                `;
            }
            
            tableHTML += `
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 1.5rem; padding: 1rem; background: var(--gray-50); border-radius: 0.75rem; text-align: center;">
                        <p style="color: var(--gray-600); font-size: 0.875rem;">
                            üí° Switch to Card View for detailed meal descriptions
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = tableHTML;
        }

        function toggleView(view) {
            currentView = view;
            document.getElementById('viewCard').style.background = view === 'card' ? 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)' : 'var(--gray-100)';
            document.getElementById('viewCard').style.color = view === 'card' ? 'white' : 'var(--gray-700)';
            document.getElementById('viewTable').style.background = view === 'table' ? 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)' : 'var(--gray-100)';
            document.getElementById('viewTable').style.color = view === 'table' ? 'white' : 'var(--gray-700)';
            
            if (currentPlan) {
                // Reconstruct BMI and season info from saved plan
                const bmi = parseFloat(currentPlan.bmi);
                const bmiInfo = getBMICategory(bmi);
                const currentSeason = getCurrentSeason();
                displayPlan(currentPlan.text, bmi, bmiInfo, currentSeason);
            }
        }

        function savePlan() {
            if (!currentPlan) return;
            
            const planName = prompt('Enter a name for this meal plan:');
            if (!planName) return;
            
            saveMealPlan(currentPlan.text, { ...currentPlan, planName });
            showNotification(`‚úÖ Saved "${planName}"!`, 'success');
        }
    </script>

    <!-- Footer -->
    <footer style="text-align: center; padding: 3rem 2rem; background: rgba(30, 35, 55, 0.5); border-top: 1px solid var(--border-color); margin-top: 4rem;">
        <p style="font-size: 1.25rem; margin-bottom: 0.5rem; font-weight: 700; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            Made for Hackathon by Team BBPS Brij Vihar üèÜ
        </p>
        <p style="color: var(--text-muted); font-size: 0.875rem;">¬© 2025 Mealora. All rights reserved.</p>
    </footer>
</body>
</html>

