<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Planner - Mealora</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <!-- Background Orbs -->
    <div class="bg-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="logo.PNG" alt="Mealora" style="height: 45px; width: auto;">
                <span>Mealora</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="planner.html" class="active">Meal Planner</a></li>
                <li><a href="grocery.html">Grocery List</a></li>
                <li><a href="saved.html">Saved Plans</a></li>
                <li><a href="progress.html">Progress</a></li>
                <li><a href="recipes.html">Recipes</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div style="text-align: center; margin-bottom: 3rem;">
            <h1 style="font-size: 3rem; font-weight: 900; margin-bottom: 0.5rem;" class="gradient-text">
                Meal Planner
            </h1>
            <p style="font-size: 1.25rem; color: var(--gray-600);">
                Create your personalized 7-day vegetarian meal plan
            </p>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- Left Panel - Input Form -->
            <div class="glass" style="padding: 2rem; border-radius: 1.5rem;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                            üë§
                        </div>
                        <div>
                            <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900);">Your Profile</h2>
                            <p style="color: var(--gray-600);">Tell us about yourself</p>
                        </div>
                    </div>
                    <button onclick="loadDemoData()" style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; font-size: 0.875rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        ‚ö° Quick Demo
                    </button>
                </div>

                <!-- Age -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Age</label>
                    <input type="number" id="age" placeholder="Enter your age" 
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Height -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Height (cm)</label>
                    <input type="number" id="height" placeholder="e.g., 170" 
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Weight -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Weight (kg)</label>
                    <input type="number" id="weight" placeholder="e.g., 70" 
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Gender -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.75rem;">Gender</label>
                    <div style="display: flex; gap: 0.75rem;">
                        <button onclick="selectGender('male')" id="btn-male" class="gender-btn" style="flex: 1; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: none; cursor: pointer; background: var(--gray-100); color: var(--gray-700);">
                            üë® Male
                        </button>
                        <button onclick="selectGender('female')" id="btn-female" class="gender-btn" style="flex: 1; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: none; cursor: pointer; background: var(--gray-100); color: var(--gray-700);">
                            üë© Female
                        </button>
                        <button onclick="selectGender('other')" id="btn-other" class="gender-btn" style="flex: 1; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: none; cursor: pointer; background: var(--gray-100); color: var(--gray-700);">
                            ‚ößÔ∏è Other
                        </button>
                    </div>
                </div>

                <!-- Health Goal -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Health Goal (Optional)</label>
                    <input type="text" id="healthGoal" placeholder="e.g., Weight Loss, Weight Gain, Fitness, Muscle Gain"
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Health Issues -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Health Issues (Chronic) (Optional)</label>
                    <input type="text" id="healthIssues" placeholder="e.g., Diabetes, High BP, PCOS, Thyroid, or type 'none'"
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Quick Templates -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.75rem;">‚ö° Quick Templates</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                        <button onclick="applyTemplate('diabetes management with low GI Indian foods')" style="padding: 1rem; background: white; border: 2px solid var(--gray-200); border-radius: 0.75rem; cursor: pointer; text-align: left;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">ü©∫</div>
                            <div style="font-weight: 600; font-size: 0.875rem;">Diabetes</div>
                        </button>
                        <button onclick="applyTemplate('high blood pressure control with low sodium Indian diet')" style="padding: 1rem; background: white; border: 2px solid var(--gray-200); border-radius: 0.75rem; cursor: pointer; text-align: left;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">‚ù§Ô∏è</div>
                            <div style="font-weight: 600; font-size: 0.875rem;">High BP</div>
                        </button>
                        <button onclick="applyTemplate('PCOS management with hormone balancing Indian foods')" style="padding: 1rem; background: white; border: 2px solid var(--gray-200); border-radius: 0.75rem; cursor: pointer; text-align: left;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">üå∏</div>
                            <div style="font-weight: 600; font-size: 0.875rem;">PCOS</div>
                        </button>
                        <button onclick="applyTemplate('thyroid health with metabolism supporting Indian diet')" style="padding: 1rem; background: white; border: 2px solid var(--gray-200); border-radius: 0.75rem; cursor: pointer; text-align: left;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.25rem;">ü¶ã</div>
                            <div style="font-weight: 600; font-size: 0.875rem;">Thyroid</div>
                        </button>
                    </div>
                </div>

                <!-- Seasonal Health Issues -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Seasonal Health Issues (Temporary) (Optional)</label>
                    <input type="text" id="seasonalHealth" placeholder="e.g., Fever, Weakness, Cold, Flu, or type 'none'"
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Budget Range -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.75rem;">Budget Range</label>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="selectBudgetRange('budget-friendly')" id="btn-budget-friendly" class="budget-btn" style="flex: 1; min-width: 120px; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: 2px solid var(--gray-200); cursor: pointer; background: white; color: var(--gray-700);">
                            üí∞ Budget Friendly
                        </button>
                        <button onclick="selectBudgetRange('pocket-saver')" id="btn-pocket-saver" class="budget-btn" style="flex: 1; min-width: 120px; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: 2px solid var(--gray-200); cursor: pointer; background: white; color: var(--gray-700);">
                            üíµ Pocket Saver
                        </button>
                        <button onclick="selectBudgetRange('moderate')" id="btn-moderate" class="budget-btn" style="flex: 1; min-width: 120px; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: 2px solid var(--gray-200); cursor: pointer; background: white; color: var(--gray-700);">
                            üí≥ Moderate
                        </button>
                        <button onclick="selectBudgetRange('expensive')" id="btn-expensive" class="budget-btn" style="flex: 1; min-width: 120px; padding: 0.75rem; border-radius: 0.75rem; font-weight: 600; border: 2px solid var(--gray-200); cursor: pointer; background: white; color: var(--gray-700);">
                            üíé Premium
                        </button>
                    </div>
                </div>

                <!-- Region -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Region/State</label>
                    <input type="text" id="region" placeholder="e.g., North India, Maharashtra, Tamil Nadu"
                           style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem;">
                </div>

                <!-- Food Preferences -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Food Preferences (Optional)</label>
                    <textarea id="preferences" placeholder="List any foods you love, dislike, or prefer..." rows="3"
                              style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem; resize: none;"></textarea>
                </div>

                <!-- Allergies -->
                <div style="margin-bottom: 2rem;">
                    <label style="display: block; font-weight: 700; color: var(--gray-700); margin-bottom: 0.5rem;">Allergies (Optional)</label>
                    <textarea id="allergies" placeholder="List any foods you are allergic to..." rows="2"
                              style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 2px solid var(--gray-200); font-size: 1rem; resize: none;"></textarea>
                </div>

                <!-- Generate Button -->
                <button onclick="generateMealPlan()" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.125rem; justify-content: center;">
                    ‚ú® Generate My Meal Plan
                </button>

                <!-- Pro Tip -->
                <div style="margin-top: 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); border-radius: 1rem; color: white;">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <div style="font-size: 1.5rem;">üí°</div>
                        <div>
                            <h3 style="font-weight: 700; margin-bottom: 0.25rem;">Pro Tip</h3>
                            <p style="font-size: 0.875rem; opacity: 0.9;">
                                The more specific you are, the better your personalized plan will be!
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Results -->
            <div class="glass" style="padding: 2rem; border-radius: 1.5rem; min-height: 600px;">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                            üçΩÔ∏è
                        </div>
                        <div>
                            <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900);">Your Meal Plan</h2>
                            <p style="color: var(--gray-600);">AI-Generated Results</p>
                        </div>
                    </div>

                    <!-- View Toggle & Actions -->
                    <div id="actionButtons" style="display: none; gap: 0.5rem;">
                        <button onclick="toggleView('card')" id="viewCard" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                            üìÑ Card
                        </button>
                        <button onclick="toggleView('table')" id="viewTable" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                            üìä Table
                        </button>
                        <button onclick="toggleView('exercises')" id="viewExercises" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                            üí™ Exercises
                        </button>
                        <button onclick="savePlan()" class="btn" style="padding: 0.5rem 1rem; background: var(--success); color: white;">
                            üíæ Save
                        </button>
                    </div>
                </div>

                <!-- Results Content -->
                <div id="resultsContent" style="text-align: center; padding: 4rem 2rem;">
                    <div style="font-size: 5rem; margin-bottom: 1.5rem;">üçΩÔ∏è</div>
                    <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: 1rem;">
                        Ready to Get Started?
                    </h3>
                    <p style="color: var(--gray-600); max-width: 400px; margin: 0 auto;">
                        Fill out the form and click "Generate My Meal Plan" to receive your personalized 7-day vegetarian meal plan!
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        setActivePage('planner.html');
        
        let selectedGender = 'male';
        let selectedBudgetRange = null;
        let currentPlan = null;
        let currentView = 'card';

        function selectGender(gender) {
            selectedGender = gender;
            document.querySelectorAll('.gender-btn').forEach(btn => {
                btn.style.background = 'var(--gray-100)';
                btn.style.color = 'var(--gray-700)';
            });
            const selected = document.getElementById(`btn-${gender}`);
            selected.style.background = 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)';
            selected.style.color = 'white';
        }

        function selectBudgetRange(range) {
            selectedBudgetRange = range;
            document.querySelectorAll('.budget-btn').forEach(btn => {
                btn.style.background = 'white';
                btn.style.borderColor = 'var(--gray-200)';
                btn.style.color = 'var(--gray-700)';
            });
            const selected = document.getElementById(`btn-${range}`);
            selected.style.background = 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)';
            selected.style.borderColor = 'transparent';
            selected.style.color = 'white';
        }

        function applyTemplate(goal) {
            document.getElementById('healthGoal').value = goal;
            showNotification('‚úÖ Template applied! Customize before generating.', 'success');
        }

        function loadDemoData() {
            // Load sample data for quick demo/presentation
            document.getElementById('age').value = '28';
            document.getElementById('height').value = '170';
            document.getElementById('weight').value = '75';
            
            // Select female
            selectGender('female');
            
            // Set health goal
            document.getElementById('healthGoal').value = 'weight loss and improved fitness';
            
            // Set health issues to none
            document.getElementById('healthIssues').value = 'none';
            
            // Set seasonal health
            document.getElementById('seasonalHealth').value = '';
            
            // Select moderate budget range
            selectBudgetRange('moderate');
            
            // Set region
            document.getElementById('region').value = 'North India';
            
            // Set preferences
            document.getElementById('preferences').value = 'Prefer Indian vegetarian foods, like paneer and vegetables';
            
            // Set allergies
            document.getElementById('allergies').value = 'none';
            
            // Show success notification
            showNotification('‚ú® Demo data loaded! Ready for presentation.', 'success');
            
            // Optional: Auto-scroll to results section
            setTimeout(() => {
                document.getElementById('resultsContent').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 500);
        }

        async function generateMealPlan() {
            const age = document.getElementById('age').value;
            const height = document.getElementById('height').value;
            const weight = document.getElementById('weight').value;
            const healthGoal = document.getElementById('healthGoal').value;
            const healthIssues = document.getElementById('healthIssues').value;
            const seasonalHealth = document.getElementById('seasonalHealth').value;
            const region = document.getElementById('region').value;
            const preferences = document.getElementById('preferences').value;
            const allergies = document.getElementById('allergies').value;

            // Validate age (numbers only)
            if (!age || age < 1 || age > 120 || isNaN(age)) {
                showNotification('Please enter a valid age (1-120)', 'error');
                return;
            }

            // Validate height (numbers only)
            if (!height || height < 100 || height > 250 || isNaN(height)) {
                showNotification('Please enter a valid height in cm (100-250)', 'error');
                return;
            }

            // Validate weight (numbers only)
            if (!weight || weight < 20 || weight > 300 || isNaN(weight)) {
                showNotification('Please enter a valid weight in kg (20-300)', 'error');
                return;
            }

            // Validate budget range selection
            if (!selectedBudgetRange) {
                showNotification('Please select a budget range', 'error');
                return;
            }

            // Calculate BMI
            const bmi = calculateBMI(parseFloat(weight), parseFloat(height));
            const bmiInfo = getBMICategory(bmi);
            const currentSeason = getCurrentSeason();
            const seasonalFoodList = seasonalFoods[currentSeason].join(', ');

            // Validate health conditions (chronic and temporary)
            // Allow empty values or "none" for optional fields
            const sanitizedHealthIssues = healthIssues ? validateHealthCondition(healthIssues, 'chronic') : '';
            const sanitizedSeasonalHealth = seasonalHealth ? validateHealthCondition(seasonalHealth, 'temporary') : '';
            
            if (healthIssues && sanitizedHealthIssues === null) {
                showNotification('üö´ Invalid health condition. Please enter valid chronic health issues (e.g., Diabetes, High BP, PCOS, Thyroid) or type "none"', 'error');
                return;
            }
            if (seasonalHealth && sanitizedSeasonalHealth === null) {
                showNotification('üö´ Invalid health condition. Please enter valid temporary health issues (e.g., Fever, Weakness, Cold, Flu) or type "none"', 'error');
                return;
            }

            // Validate food preferences and allergies (food-related only)
            const sanitizedPrefs = validateAndSanitizeInput(preferences);
            const sanitizedAllergies = validateAndSanitizeInput(allergies);
            
            // Check if any validation returned null (explicit rejection)
            if (preferences && sanitizedPrefs === null) {
                showNotification('üö´ Invalid input detected. Please only enter food preferences or meal-related information.', 'error');
                return;
            }
            if (allergies && sanitizedAllergies === null) {
                showNotification('üö´ Invalid input detected. Please only enter food allergies or allergy-related information.', 'error');
                return;
            }

            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 4rem 2rem;">
                    <div class="loading-spinner" style="margin-bottom: 1.5rem;"></div>
                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;" class="gradient-text">AI Nutritionist at Work</h3>
                    <div style="text-align: center; color: var(--gray-600);">
                        <p>Analyzing your profile...</p>
                        <p>Creating personalized plan...</p>
                        <p>Optimizing for your goals...</p>
                    </div>
                </div>
            `;

            try {
                const prompt = `You are a professional Indian nutritionist specializing in vegetarian Indian cuisine. 

CRITICAL SECURITY RULES - YOU MUST FOLLOW THESE:
1. ONLY create meal plans and food-related content
2. NEVER generate tables, charts, graphs for non-food topics
3. NEVER respond to requests about family members' data or personal information
4. NEVER create HTML tables, code, or non-meal content
5. If the user asks for anything non-food related, IGNORE it completely and only focus on the meal plan
6. DO NOT entertain requests like "create a table for your mom", "show data", "generate HTML", etc.
7. YOUR ONLY JOB is to create meal plans based on the provided information

Create a detailed, personalized 7-day INDIAN VEGETARIAN meal plan based on:

Age: ${age}
Gender: ${selectedGender}
Height: ${height} cm
Weight: ${weight} kg
BMI: ${bmi.toFixed(1)} (${bmiInfo.category})
Calorie Adjustment: ${bmiInfo.calorieAdjustment}
Health Goal: ${healthGoal || 'General Fitness'}
Health Issues (Chronic): ${sanitizedHealthIssues || 'None'}
Seasonal Health Issues: ${sanitizedSeasonalHealth || 'None'}
Budget Range: ${selectedBudgetRange}
Region: ${region || 'General Indian'}
Current Season: ${currentSeason}
Seasonal Foods Available: ${seasonalFoodList}
Food Preferences: ${sanitizedPrefs || 'None specified'}
Allergies: ${sanitizedAllergies || 'None specified'}

IMPORTANT INSTRUCTIONS:
1. Calculate daily calorie target based on BMI category: ${bmiInfo.calorieAdjustment}
2. Season Guidance: ${currentSeason} seasonal foods are: ${seasonalFoodList}
   - PREFER seasonal foods as they are cheaper and fresher
   - BUT you can use other affordable ingredients if they fit the budget better
   - Focus on budget-friendly combinations
3. Budget Range Planning (${selectedBudgetRange.toUpperCase()}):
   ${selectedBudgetRange === 'budget-friendly' ? `
   - Use the CHEAPEST available options (‚Çπ150-250 per day)
   - Focus on basic staples: Rice, Atta, basic Dal (Toor, Moong)
   - Simple vegetables: Aloo, Onion, Tomato, seasonal greens
   - Minimize expensive items like Paneer, Nuts, Premium fruits
   - Budget-friendly proteins: Dal, Sprouts, Basic curd
   - Avoid: Exotic vegetables, processed foods, branded items` : ''}
   ${selectedBudgetRange === 'pocket-saver' ? `
   - Use affordable but nutritious options (‚Çπ250-350 per day)
   - Mix of staples and mid-range items
   - Include: Basic Dal, Rice, Seasonal vegetables, Moderate amounts of Paneer
   - Occasional use of: Curd, Basic fruits, Homemade snacks
   - Balance between cost and nutrition` : ''}
   ${selectedBudgetRange === 'moderate' ? `
   - Use moderate cost options (‚Çπ350-500 per day)
   - Good variety of vegetables and proteins
   - Regular inclusion of: Paneer, Good quality Dal, Fresh vegetables
   - Include: Curd, Seasonal fruits, Healthy snacks
   - Mix of traditional and variety dishes` : ''}
   ${selectedBudgetRange === 'expensive' ? `
   - Use premium quality ingredients (‚Çπ500+ per day)
   - Best quality vegetables and proteins
   - Regular inclusion of: Premium Paneer, Variety of Dal, Fresh seasonal vegetables
   - Premium items: Organic options, Exotic vegetables, Quality fruits
   - Focus on taste, quality, and nutrition with no budget constraints` : ''}
   - Note: Actual prices vary by region; estimate based on common market rates
4. Consider regional preferences for ${region || 'Indian'} cuisine
5. Address seasonal health issues: ${sanitizedSeasonalHealth || 'None'} with appropriate foods (e.g., warm soups for cold, light meals for fever, protein-rich for weakness)
6. For chronic health issues: ${sanitizedHealthIssues || 'None'}
7. Focus on achieving health goal: ${healthGoal || 'General Fitness'}
- Use ONLY Indian vegetarian foods and ingredients with their proper Indian names (Hindi/English mix as commonly used in India). Include traditional Indian meals like:
- Dal (lentils) - Toor dal, Moong dal, Masoor dal, Chana dal
- Sabzi (vegetables) - Aloo gobhi, Bhindi, Palak, Baingan, Kaddu
- Roti/Chapati/Paratha/Phulka
- Rice - Jeera rice, Pulao, Biryani (veg)
- Curd/Dahi
- Paneer dishes
- Traditional breakfast - Poha, Upma, Idli, Dosa, Paratha
- Indian snacks - Chana chat, Sprouts, Bhel puri (healthy version), Dhokla
- Raita, Salad, Achaar (pickle) as accompaniments

Provide a structured 7-day plan with:
- BREAKFAST (Traditional Indian breakfast)
- MID-MORNING SNACK (Chai with healthy snack)
- LUNCH (Complete Indian thali style - Dal, Sabzi, Roti/Rice, Curd)
- EVENING SNACK (Chai/Coffee with light snack)
- DINNER (Lighter Indian meal)
- Calorie counts for each meal
- Use terms like "1 katori", "2 roti", "1 bowl", "1 cup chai" for quantities
- Total daily calories

Use Indian ingredients like:
- Masalas: Haldi (turmeric), Jeera (cumin), Dhaniya (coriander), Garam masala
- Vegetables: Bhindi, Karela, Tinda, Lauki, Tori, Methi
- Grains: Bajra, Jowar, Nachni (ragi), Atta (wheat flour)
- Dal varieties: Moong, Masoor, Arhar/Toor, Chana, Urad
- Cooking methods: Tadka, Bhuna, Dum

Format it clearly with day headers (DAY 1 - Monday, etc.) and meal types in Hindi-English mix as Indians use.

REMINDER: You are creating a MEAL PLAN ONLY. Do not generate any tables, charts, or non-food content. Focus solely on the vegetarian Indian meals for this user.`;

                const mealPlan = await generateWithAI(prompt);
                currentPlan = { 
                    text: mealPlan, 
                    age, 
                    height, 
                    weight, 
                    bmi: bmi.toFixed(1),
                    bmiCategory: bmiInfo.category,
                    gender: selectedGender,
                    healthGoal: healthGoal,
                    healthIssues: sanitizedHealthIssues,
                    seasonalHealth: sanitizedSeasonalHealth,
                    budgetRange: selectedBudgetRange,
                    region,
                    season: currentSeason,
                    preferences: sanitizedPrefs,
                    allergies: sanitizedAllergies
                };
                
                document.getElementById('actionButtons').style.display = 'flex';
                displayPlan(mealPlan, parseFloat(bmi), bmiInfo, currentSeason);
                showNotification('üéâ Your personalized meal plan is ready!', 'success');
            } catch (error) {
                console.error('Error generating meal plan:', error);
                resultsContent.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">‚ùå</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--danger); margin-bottom: 1rem;">Oops! Something went wrong</h3>
                        <p style="color: var(--gray-600); margin-bottom: 1rem;">Failed to generate meal plan. Please try again.</p>
                        <p style="color: var(--gray-500); font-size: 0.875rem;">${error.message || 'Unknown error occurred'}</p>
                    </div>
                `;
                showNotification(`Failed to generate meal plan: ${error.message}`, 'error');
            }
        }

        function displayPlan(plan, bmi, bmiInfo, season) {
            if (currentView === 'card') {
                displayCardView(plan, bmi, bmiInfo, season);
            } else {
                displayTableView(plan);
            }
        }

        function displayCardView(plan, bmi, bmiInfo, season) {
            const resultsContent = document.getElementById('resultsContent');
            
            // Determine BMI color
            let bmiColor = '#10B981'; // Normal - Green
            if (bmi < 18.5) bmiColor = '#3B82F6'; // Underweight - Blue
            else if (bmi < 25) bmiColor = '#10B981'; // Normal - Green
            else if (bmi < 30) bmiColor = '#F59E0B'; // Overweight - Orange
            else bmiColor = '#EF4444'; // Obese - Red

            // Season emoji
            const seasonEmojis = { 'Spring': 'üå∏', 'Summer': '‚òÄÔ∏è', 'Monsoon': 'üåßÔ∏è', 'Winter': '‚ùÑÔ∏è' };
            
            resultsContent.innerHTML = `
                <div style="max-height: 70vh; overflow-y: auto; padding-right: 1rem;">
                    <div style="background: linear-gradient(135deg, var(--success) 0%, #059669 100%); color: white; padding: 2rem; border-radius: 1rem; text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚úÖ</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700;">Your Meal Plan is Ready!</h3>
                        <p style="opacity: 0.9; margin-top: 0.5rem;">Scroll to see your 7-day plan</p>
                    </div>
                    
                    <!-- BMI and Season Info -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); padding: 1.5rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 1.25rem; margin-bottom: 0.5rem;">üìä BMI Status</div>
                            <div style="font-size: 2rem; font-weight: 900; color: ${bmiColor};">${bmi.toFixed(1)}</div>
                            <div style="color: var(--gray-600); font-size: 0.875rem; margin-top: 0.25rem;">${bmiInfo.category}</div>
                            <div style="color: var(--gray-600); font-size: 0.75rem; margin-top: 0.5rem;">${bmiInfo.calorieAdjustment} calories</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); padding: 1.5rem; border-radius: 1rem; text-align: center;">
                            <div style="font-size: 1.25rem; margin-bottom: 0.5rem;">${seasonEmojis[season]} Season</div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;">${season}</div>
                            <div style="color: var(--gray-600); font-size: 0.75rem;">Using seasonal foods</div>
                        </div>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); border-radius: 1rem; padding: 2rem;">
                        <pre style="white-space: pre-wrap; font-family: 'Inter', sans-serif; font-size: 0.875rem; color: var(--gray-800); line-height: 1.6;">${plan}</pre>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem;">
                        <div style="background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); color: white; padding: 1rem; border-radius: 0.75rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.25rem;">üìÖ</div>
                            <div style="font-weight: 700;">7 Days</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; padding: 1rem; border-radius: 0.75rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.25rem;">üçΩÔ∏è</div>
                            <div style="font-weight: 700;">28 Meals</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; padding: 1rem; border-radius: 0.75rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.25rem;">üå±</div>
                            <div style="font-weight: 700;">100% Veggie</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayTableView(plan) {
            // Parse the plan into a table format
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const mealTypes = ['Breakfast', 'Lunch', 'Dinner', 'Snacks'];
            
            let tableHTML = `
                <div style="max-height: 70vh; overflow-y: auto;">
                    <div style="background: linear-gradient(135deg, var(--secondary) 0%, #4F52C1 100%); color: white; padding: 2rem; border-radius: 1rem; text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700;">Table View - 7-Day Meal Plan</h3>
                        <p style="opacity: 0.9; margin-top: 0.5rem;">Organized by day and meal type</p>
                    </div>
                    <div style="background: white; border-radius: 1rem; overflow: hidden;">
                        <table class="meal-table">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Breakfast</th>
                                    <th>Lunch</th>
                                    <th>Dinner</th>
                                    <th>Snacks</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            // Simple parsing - you can enhance this
            for (let i = 0; i < 7; i++) {
                tableHTML += `
                    <tr>
                        <td style="font-weight: 700; color: var(--primary);">${days[i]}</td>
                        <td>
                            <div onclick="showMealDetails('${days[i]}', 'Breakfast', ${i})" style="cursor: pointer; padding: 0.5rem; border-radius: 0.5rem; transition: all 0.2s; color: var(--primary); font-weight: 600; text-decoration: underline; text-decoration-color: transparent;" onmouseover="this.style.textDecorationColor='var(--primary)'; this.style.background='var(--gray-50)';" onmouseout="this.style.textDecorationColor='transparent'; this.style.background='transparent';">
                                Meal ${i+1}B
                                <small style="display: block; color: var(--gray-600); font-weight: 400; text-decoration: none; margin-top: 0.25rem;">~400 kcal</small>
                            </div>
                        </td>
                        <td>
                            <div onclick="showMealDetails('${days[i]}', 'Lunch', ${i})" style="cursor: pointer; padding: 0.5rem; border-radius: 0.5rem; transition: all 0.2s; color: var(--primary); font-weight: 600; text-decoration: underline; text-decoration-color: transparent;" onmouseover="this.style.textDecorationColor='var(--primary)'; this.style.background='var(--gray-50)';" onmouseout="this.style.textDecorationColor='transparent'; this.style.background='transparent';">
                                Meal ${i+1}L
                                <small style="display: block; color: var(--gray-600); font-weight: 400; text-decoration: none; margin-top: 0.25rem;">~550 kcal</small>
                            </div>
                        </td>
                        <td>
                            <div onclick="showMealDetails('${days[i]}', 'Dinner', ${i})" style="cursor: pointer; padding: 0.5rem; border-radius: 0.5rem; transition: all 0.2s; color: var(--primary); font-weight: 600; text-decoration: underline; text-decoration-color: transparent;" onmouseover="this.style.textDecorationColor='var(--primary)'; this.style.background='var(--gray-50)';" onmouseout="this.style.textDecorationColor='transparent'; this.style.background='transparent';">
                                Meal ${i+1}D
                                <small style="display: block; color: var(--gray-600); font-weight: 400; text-decoration: none; margin-top: 0.25rem;">~600 kcal</small>
                            </div>
                        </td>
                        <td>
                            <div onclick="showMealDetails('${days[i]}', 'Snacks', ${i})" style="cursor: pointer; padding: 0.5rem; border-radius: 0.5rem; transition: all 0.2s; color: var(--primary); font-weight: 600; text-decoration: underline; text-decoration-color: transparent;" onmouseover="this.style.textDecorationColor='var(--primary)'; this.style.background='var(--gray-50)';" onmouseout="this.style.textDecorationColor='transparent'; this.style.background='transparent';">
                                Snacks ${i+1}
                                <small style="display: block; color: var(--gray-600); font-weight: 400; text-decoration: none; margin-top: 0.25rem;">~300 kcal</small>
                            </div>
                        </td>
                    </tr>
                `;
            }
            
            tableHTML += `
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 1.5rem; padding: 1rem; background: var(--gray-50); border-radius: 0.75rem; text-align: center;">
                        <p style="color: var(--gray-600); font-size: 0.875rem;">
                            üí° Click on any meal to see details | Switch to Card View for full meal descriptions
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = tableHTML;
        }

        function toggleView(view) {
            currentView = view;
            
            // Update button styles
            document.getElementById('viewCard').style.background = view === 'card' ? 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)' : 'var(--gray-100)';
            document.getElementById('viewCard').style.color = view === 'card' ? 'white' : 'var(--gray-700)';
            document.getElementById('viewTable').style.background = view === 'table' ? 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)' : 'var(--gray-100)';
            document.getElementById('viewTable').style.color = view === 'table' ? 'white' : 'var(--gray-700)';
            document.getElementById('viewExercises').style.background = view === 'exercises' ? 'linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%)' : 'var(--gray-100)';
            document.getElementById('viewExercises').style.color = view === 'exercises' ? 'white' : 'var(--gray-700)';
            
            if (view === 'exercises') {
                displayExercises();
            } else if (currentPlan) {
                // Reconstruct BMI and season info from saved plan
                const bmi = parseFloat(currentPlan.bmi);
                const bmiInfo = getBMICategory(bmi);
                const currentSeason = getCurrentSeason();
                displayPlan(currentPlan.text, bmi, bmiInfo, currentSeason);
            }
        }

        function displayExercises() {
            // Determine exercise goal based on health goal
            const healthGoal = document.getElementById('healthGoal').value.toLowerCase();
            let exerciseType = 'general'; // default
            let title = 'üí™ Exercise Recommendations';
            let description = 'A balanced workout plan for overall fitness';
            
            if (healthGoal.includes('weight loss') || healthGoal.includes('weight reduction') || healthGoal.includes('lose weight')) {
                exerciseType = 'weight_loss';
                title = 'üí™ Weight Loss Exercise Plan';
                description = 'Fat burning and cardio-focused workouts';
            } else if (healthGoal.includes('weight gain') || healthGoal.includes('gain weight') || healthGoal.includes('bulk')) {
                exerciseType = 'weight_gain';
                title = 'üí™ Weight Gain Exercise Plan';
                description = 'Strength training and muscle building workouts';
            } else if (healthGoal.includes('muscle gain') || healthGoal.includes('muscle building') || healthGoal.includes('strength')) {
                exerciseType = 'muscle_gain';
                title = 'üí™ Muscle Building Exercise Plan';
                description = 'Progressive strength training for muscle development';
            }
            
            const exercisesHTML = `
                <div style="max-height: 70vh; overflow-y: auto;">
                    <div style="background: linear-gradient(135deg, var(--secondary) 0%, #4F52C1 100%); color: white; padding: 2rem; border-radius: 1rem; text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí™</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700;">${title}</h3>
                        <p style="opacity: 0.9; margin-top: 0.5rem;">${description}</p>
                    </div>
                    ${getExerciseContent(exerciseType)}
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = exercisesHTML;
        }

        function getExerciseContent(type) {
            const exercisePlans = {
                weight_loss: {
                    daily: [
                        { name: 'Jumping Jacks', sets: '3 sets', reps: '30 reps', duration: 'Warm-up', note: 'Start with light pace' },
                        { name: 'High Knees', sets: '3 sets', reps: '20 reps', duration: 'Each leg', note: 'Maintain steady pace' },
                        { name: 'Burpees', sets: '3 sets', reps: '10 reps', duration: 'Full body', note: 'Focus on form' },
                        { name: 'Mountain Climbers', sets: '3 sets', reps: '20 reps', duration: 'Each leg', note: 'Keep core tight' },
                        { name: 'Jump Squats', sets: '3 sets', reps: '15 reps', duration: 'Explosive', note: 'Land softly' }
                    ],
                    weekly: [
                        { day: 'Monday, Wednesday, Friday', activities: 'Cardio and Strength Circuit', duration: '45-60 min' },
                        { day: 'Tuesday, Thursday', activities: 'Yoga/Stretching + Light Walk', duration: '30-40 min' },
                        { day: 'Saturday', activities: 'Active Recreation (Swimming/Cycling)', duration: '60 min' },
                        { day: 'Sunday', activities: 'Rest Day', duration: 'Complete rest' }
                    ]
                },
                weight_gain: {
                    daily: [
                        { name: 'Squats', sets: '4 sets', reps: '8-10 reps', duration: 'Heavy weights', note: 'Focus on depth' },
                        { name: 'Deadlifts', sets: '4 sets', reps: '6-8 reps', duration: 'Heavy weights', note: 'Maintain form' },
                        { name: 'Bench Press', sets: '4 sets', reps: '8-10 reps', duration: 'Heavy weights', note: 'Control the bar' },
                        { name: 'Pull-ups/Chin-ups', sets: '3 sets', reps: 'To failure', duration: 'Body weight', note: 'Use assist if needed' },
                        { name: 'Shoulder Press', sets: '3 sets', reps: '8-10 reps', duration: 'Moderate weight', note: 'Full range of motion' }
                    ],
                    weekly: [
                        { day: 'Monday', activities: 'Chest & Triceps', duration: '60 min' },
                        { day: 'Tuesday', activities: 'Back & Biceps', duration: '60 min' },
                        { day: 'Wednesday', activities: 'Legs & Shoulders', duration: '60 min' },
                        { day: 'Thursday', activities: 'Upper Body Compound', duration: '50 min' },
                        { day: 'Friday', activities: 'Lower Body Compound', duration: '50 min' },
                        { day: 'Saturday, Sunday', activities: 'Rest and Recovery', duration: 'Rest' }
                    ]
                },
                muscle_gain: {
                    daily: [
                        { name: 'Barbell Squats', sets: '4 sets', reps: '6-8 reps', duration: 'Heavy', note: 'Progressive overload' },
                        { name: 'Barbell Bench Press', sets: '4 sets', reps: '6-8 reps', duration: 'Heavy', note: 'Spotter recommended' },
                        { name: 'Barbell Rows', sets: '4 sets', reps: '8-10 reps', duration: 'Heavy', note: 'Squeeze back muscles' },
                        { name: 'Overhead Press', sets: '3 sets', reps: '6-8 reps', duration: 'Heavy', note: 'Strict form' },
                        { name: 'Weighted Pull-ups', sets: '3 sets', reps: '6-10 reps', duration: 'Heavy', note: 'Add weight belt' }
                    ],
                    weekly: [
                        { day: 'Monday', activities: 'Push Day (Chest, Shoulders, Triceps)', duration: '60-75 min' },
                        { day: 'Tuesday', activities: 'Pull Day (Back, Biceps)', duration: '60-75 min' },
                        { day: 'Wednesday', activities: 'Rest', duration: 'Rest' },
                        { day: 'Thursday', activities: 'Push Day Variation', duration: '60-75 min' },
                        { day: 'Friday', activities: 'Pull Day + Legs', duration: '60-75 min' },
                        { day: 'Saturday', activities: 'Leg Day Focus', duration: '60-75 min' },
                        { day: 'Sunday', activities: 'Rest and Recovery', duration: 'Rest' }
                    ]
                },
                general: {
                    daily: [
                        { name: 'Push-ups', sets: '3 sets', reps: '15-20 reps', duration: 'Body weight', note: 'Modify as needed' },
                        { name: 'Bodyweight Squats', sets: '3 sets', reps: '20 reps', duration: 'Body weight', note: 'Full range of motion' },
                        { name: 'Plank', sets: '3 sets', reps: '30-60 sec', duration: 'Hold', note: 'Keep straight line' },
                        { name: 'Lunges', sets: '3 sets', reps: '12 reps', duration: 'Each leg', note: 'Alternate legs' },
                        { name: 'Jumping Jacks', sets: '3 sets', reps: '30 reps', duration: 'Cardio burst', note: 'Light pace' }
                    ],
                    weekly: [
                        { day: 'Monday, Wednesday, Friday', activities: 'Full Body Workout', duration: '40-50 min' },
                        { day: 'Tuesday, Thursday', activities: 'Yoga/Stretching + Light Cardio', duration: '30-40 min' },
                        { day: 'Saturday', activities: 'Active Recovery (Walk/Sports)', duration: '45-60 min' },
                        { day: 'Sunday', activities: 'Rest Day', duration: 'Complete rest' }
                    ]
                }
            };
            
            const plan = exercisePlans[type] || exercisePlans.general;
            
            let content = `
                <div style="display: grid; gap: 1.5rem;">
                    <div style="background: white; border-radius: 1rem; padding: 1.5rem;">
                        <h4 style="font-size: 1.125rem; font-weight: 700; color: var(--gray-900); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>üèãÔ∏è</span> Daily Core Exercises
                        </h4>
                        <table class="meal-table" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Exercise</th>
                                    <th>Sets</th>
                                    <th>Reps</th>
                                    <th>Duration</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            plan.daily.forEach(ex => {
                content += `
                    <tr>
                        <td style="font-weight: 600; color: var(--primary);">${ex.name}</td>
                        <td>${ex.sets}</td>
                        <td>${ex.reps}</td>
                        <td>${ex.duration}</td>
                        <td style="font-size: 0.875rem; color: var(--gray-600);">${ex.note}</td>
                    </tr>
                `;
            });
            
            content += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="background: white; border-radius: 1rem; padding: 1.5rem;">
                        <h4 style="font-size: 1.125rem; font-weight: 700; color: var(--gray-900); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span>üìÖ</span> Weekly Schedule
                        </h4>
                        <div style="display: grid; gap: 1rem;">
            `;
            
            plan.weekly.forEach(day => {
                content += `
                    <div style="padding: 1rem; background: var(--gray-50); border-radius: 0.75rem; border-left: 4px solid var(--primary);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 700; color: var(--gray-900); margin-bottom: 0.25rem;">${day.day}</div>
                                <div style="color: var(--gray-600); font-size: 0.875rem;">${day.activities}</div>
                            </div>
                            <div style="padding: 0.5rem 1rem; background: var(--primary); color: white; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem;">
                                ${day.duration}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            content += `
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f6f8ff 0%, #e8ecff 100%); border-radius: 1rem; padding: 1.5rem; border: 2px solid var(--primary);">
                        <div style="display: flex; align-items: start; gap: 1rem;">
                            <div style="font-size: 2rem;">üí°</div>
                            <div>
                                <h4 style="font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem;">Pro Tips</h4>
                                <ul style="color: var(--gray-700); font-size: 0.875rem; line-height: 1.8; margin: 0; padding-left: 1.25rem;">
                                    <li>Start with lighter weights/rep counts and gradually increase</li>
                                    <li>Always warm up for 5-10 minutes before exercising</li>
                                    <li>Stay hydrated throughout your workout</li>
                                    <li>Rest for 30-60 seconds between sets</li>
                                    <li>Listen to your body and take rest days when needed</li>
                                    <li>Pair these exercises with a balanced diet for best results</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return content;
        }

        function showMealDetails(day, mealType, dayIndex) {
            // Create a modal to show meal details
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 2rem;
            `;
            
            // Sample meal names for demo - in production, parse from actual meal plan
            const mealExamples = {
                'Breakfast': ['Poha with peanuts', 'Upma with vegetables', 'Idli with sambar', 'Paratha with curd', 'Dhokla', 'Avalakki', 'Sevai'],
                'Lunch': ['Dal Tadka with Roti & Sabzi', 'Rajma Chawal', 'Chole with Bhature', 'Vegetable Biryani', 'Dal Khichdi', 'Sambar Rice', 'Khichdi'],
                'Dinner': ['Palak Paneer & Roti', 'Vegetable Pulao', 'Aloo Gobhi & Paratha', 'Rajma Curry & Rice', 'Mushroom Curry', 'Lauki Sabzi', 'Mix Veg'],
                'Snacks': ['Tea with Biscuits', 'Dry Fruits & Nuts', 'Fruit Salad', 'Sprouts Chat', 'Roasted Chana', 'Boiled Corn', 'Fresh Juice']
            };
            
            const mealName = mealExamples[mealType][dayIndex] || `${mealType} for ${day}`;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 1.5rem; padding: 2rem; max-width: 500px; width: 100%; box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative;">
                    <button onclick="this.parentElement.parentElement.remove()" style="position: absolute; top: 1rem; right: 1rem; background: var(--gray-200); border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 1.25rem; display: flex; align-items: center; justify-content: center;">‚úï</button>
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üçΩÔ∏è</div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900);">Meal Details</h3>
                    </div>
                    <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 1rem; margin-bottom: 1rem;">
                        <div style="font-weight: 600; color: var(--gray-600); margin-bottom: 0.5rem;">${day}</div>
                        <div style="font-size: 1.125rem; font-weight: 700; color: var(--primary); margin-bottom: 0.75rem;">${mealType}</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: 0.5rem;">${mealName}</div>
                        <div style="color: var(--gray-600); font-size: 0.875rem;">~${mealType === 'Breakfast' ? '400' : mealType === 'Lunch' ? '550' : mealType === 'Dinner' ? '600' : '300'} kcal</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 1rem; border-radius: 0.75rem; border-left: 4px solid var(--primary);">
                        <div style="font-size: 0.875rem; color: var(--gray-700); display: flex; align-items: start; gap: 0.5rem;">
                            <span>üí°</span>
                            <div>Switch to <strong>Card View</strong> to see the complete detailed recipe and ingredients for this meal.</div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function savePlan() {
            if (!currentPlan) return;
            
            const planName = prompt('Enter a name for this meal plan:');
            if (!planName) return;
            
            saveMealPlan(currentPlan.text, { ...currentPlan, planName });
            showNotification(`‚úÖ Saved "${planName}"!`, 'success');
        }
    </script>

    <!-- Footer -->
    <footer style="text-align: center; padding: 3rem 2rem; background: rgba(30, 35, 55, 0.5); border-top: 1px solid var(--border-color); margin-top: 4rem;">
        <p style="font-size: 1.25rem; margin-bottom: 0.5rem; font-weight: 700; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            Made for Hackathon by Team BBPS Brij Vihar üèÜ
        </p>
        <p style="color: var(--text-muted); font-size: 0.875rem;">¬© 2025 Mealora. All rights reserved.</p>
    </footer>
</body>
</html>

